
<!DOCTYPE html>
<html>

<head>

    <title>Feuerwehr Karte</title>


    <link rel="stylesheet" href="indexStyleSheet.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
</head>

<body>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>

    <div id="map"></div>



    <script>
        var map = L.map('map').setView([52.41037, 10.17706], 15);



        var opernStreetMap = new L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);



        
        var OpenRailwayMap = new L.TileLayer('http://{s}.tiles.openrailwaymap.org/standard/{z}/{x}/{y}.png',
        {
	        attribution: '<a href="https://www.openstreetmap.org/copyright">© OpenStreetMap contributors</a>, Style: <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA 2.0</a> <a href="http://www.openrailwaymap.org/">OpenRailwayMap</a> and OpenStreetMap',
	        minZoom: 2,
	        maxZoom: 19,
	        tileSize: 256
        }).addTo(map);

/*
        var marker = L.marker([52.41037, 10.17706]).addTo(map);
        marker.bindPopup("<b>Hydrant</b><br>Unterflur<br>Auf Grünfläche<br>100mm Durchmesser").openPopup();

        var marker2 = L.marker([52.41137, 10.17806]).addTo(map);
        marker2.bindPopup("<b>Hydrant</b><br>Unterflur<br>Auf Grünfläche<br>100mm Durchmesser").openPopup();

        map.setView([52.41037, 10.17706], 15);
*/
        GetData();


        async function GetData(){
         
            //API URl
            var url = "https://overpass-api.de/api/interpreter"

            //Change request at https://overpass-turbo.eu/# and export as xml
            var request = 
            `
            [out:xml][timeout:25];
            (
            node["emergency"="fire_hydrant"](52.39959100269022,10.061759948730469,52.54253746965676,10.281486511230469);
            );
            out body;
            >;
            out skel qt;
            `



            console.log("Getting Data...")
            console.log("Starting API request...")
            console.log(request);
            

            
            request = "data="+encodeURIComponent(request);

            let data = new FormData();

            data.append('data',request);

           

             fetch(url, {method: 'POST', body:request,}).then(data => {
                data.text().then(function(result){ 

                    //Gathered Data:
                    console.log("Gathering API Data...")
                    console.log(result)
                
                    
                    

                    var xmlFile;
                    if(window.ActiveXObject)  
                    {  
                        xmlFile = new ActiveXObject('Microsoft.XMLDOM'); // For IE6, IE5  
                        xmlFile.async = 'false';  
                        xmlFile.loadXML(result);  
                    }  
                    else  
                    {  
                        var parser = new DOMParser();  
                        xmlFile = parser.parseFromString(result, 'text/xml'); // For Firefox, Chrome etc  
                    }  

                    var nodes =  xmlFile.getElementsByTagName("node");

                    for(let i = 0; i < nodes.length; i++){

                        var marker = L.marker([nodes[i].getAttribute("lat"), nodes[i].getAttribute("lon")]).addTo(map);

                        let popUpHTML;
                        popUpHTML = "<b>Hydrant</b>"

                        let tag = nodes[i].getElementsByTagName('tag');

                        //Loop trough tag's of Node
                        for(let x = 0; x < tag.length; x++){
                            //Get Atrributes of tag
                            let k = tag[x].getAttribute('k');
                            let v = tag[x].getAttribute('v');
                            console.log(k, v);


                            if(k == "fire_hydrant:type"){
                                //console.log(k, v);

                                switch(v)
                                {
                                    case 'underground':
                                        popUpHTML += "<br>Unterflur";
                                        break;

                                    case 'pillar':
                                        popUpHTML += "<br>Oberflur";
                                    break;

                                    case 'pipe':
                                        popUpHTML += "<br>Anschlussrohr";
                                    break;

                                    case 'wall':
                                        popUpHTML += "<br>Wandhydrant";
                                    break;

                                    default:
                                    break;
                                }
                            }


                            if (k == "fire_hydrant:position") {
                                switch (v) {
                                    case 'green':
                                        popUpHTML += "<br>Auf Grünfläche";
                                        break;

                                    case 'lane':
                                        popUpHTML += "<br>Auf Straßenfläche";
                                        break;

                                    case 'sidewalk':
                                        popUpHTML += "<br>Auf Bürgersteig";
                                        break;

                                    case 'parking_lot':
                                        popUpHTML +=  "<br>Auf Parkplatz";
                                        break;
                                    default:
                                        break;
                                }


                            }

                            if(k == "fire_hydrant:diameter"){
                                popUpHTML += "<br>Durchmesser " + v;
                            }

                            if(k == "flow_rate"){
                                popUpHTML += "<br>Durchflussmenge " + v;
                            }
                        }


                        marker.bindPopup(popUpHTML).openPopup();

                       

                    }
                    map.setView([52.41037, 10.17706], 15);


                })
            })

        }


    </script>


</body>



</html>